<div class="container" data-controller="pixelate-image typed ">
  <div class="row justify-content-center">
    <div class="test" data-typed-target="test">
      <div class="text">
      </div>
    </div>
    <div class="col-12 col-sm-10 col-md-8 col-lg-8">
      <h3 class="mt-3 mb-3">Details</h3>
      <div class="row">
        <div>
          <div class="w-100 overflow-hidden">
            <%# the image %>
            <div data-pixelate-image-target="image" data-action="click->pixelate-image#coordinates">
              <%= cl_image_tag @result.photo.key, height: 400, width: 400, crop: :fill, style: ("display: none;" unless @result.cells.empty?) %>
            </div>
            <div class="m-3">
              <%# if they have not created cells, will display a button %>
              <% if @result.cells.empty? %>
                <%= simple_form_for [@result, @cell] do |f| %>
                  <%= f.submit "Break down image", class: "button mt-3", data:{action:"click->typed#display"} %>
                <% end %>
              <% else %>
                <p>See image breakdown below</p>
              <% end %>
              <button data-action="click->typed#display">Test</button>
            </div>
            <div>
              <div class="grid-container w-100">
                <%# cell results built into an image %>
                <% @result.cells.order(row: :asc, col: :asc).each do |cell| %>
                  <%= image_tag(cell.photo_url, class: "w-100 cell #{ "gridstyle" if cell.danger? }") %>
                <% end %>
              </div>
            </div>
            <div class="">
              <%# 2 buttons to start blur action and re-verifi %>
              <button class="button mt-3" data-action="click->pixelate-image#start">Click to start blurring</button>
              <form action="/image_results" method="POST">
                <input type="text" data-pixelate-image-target="input" hidden name="url_image">
                <% form_authenticity_token %>
                <input type="submit" class="button mt-3" value="Click to Re-verifi">
              </form>
            </div>
          </div>
          <div Class=" mt-3 mb-2">
            <%# text risks section %>
            <% if @result.profanity_type %>
              <h3><%= @result.profanity_intensity.html_safe.capitalize %> Intensity <%= @result.profanity_type.html_safe.capitalize %> Profanity Found: <em><%= @result.profanity_match.html_safe.capitalize %></em></h3>
            <% end %>
          </div>
        </div>
        <div class="mb-2">
          <%# image risks section %>
          <% if @categories.values.all?(nil) %>
            <h3 class="mt-3">No imagery related risks</h3>
          <% else %>
            <h3 class="mt-3">Imagery related risks:</h3>
            <% if @danger.empty? && @caution.empty? %>
              <p><strong>Low risk for removal</strong></p>
            <% else %>
              <p><strong>Your photo is at risk due to high <%= @danger.join(", ") %> levels</strong></p>
              <% if !@danger.empty? %>
                <p data-bs-toggle="collapse" data-bs-target="#dangercollapse">High: <span class="risk-label at-high-risk"><%= @danger.join(", ") %> <i class="fa-regular fa-circle-question"></i></span></p>
                <div class="collapse border border-1 rounded p-3 mb-3" id="dangercollapse" >
                  <% @danger.each do |cat| %>
                    <p><em><%= cat %></em></p>
                    <p><%= @descriptions[cat] %></p>
                  <% end %>
                </div>
              <% end %>
              <% if !@caution.empty? %>
                <p data-bs-toggle="collapse" data-bs-target="#cautioncollapse">Caution: <span class="risk-label at-risk"><%= @caution.join(", ")  %> <i class="fa-regular fa-circle-question"></i></span></p>
                <div class="collapse border border-1 rounded p-3 mb-3" id="cautioncollapse" >
                  <% @caution.each do |cat| %>
                    <p><em><%= cat %></em></p>
                    <p><%= @descriptions[cat] %></p>
                  <% end %>
                </div>
              <% end %>
              <% if !@safe.empty? %>
                <p>Safe:
                  <% @safe.each_with_index do |cat, index|%>
                    <span data-bs-toggle="collapse" data-bs-target="#safecollapse<%=index%>" class="risk-label no-risk"><%= cat %> <i class="fa-regular fa-circle-question"></i></span>
                  <% end %>
                </p>
                <% @safe.each_with_index do |cat, index| %>
                  <div class="collapse  border border-1 rounded p-3 mb-3" id="safecollapse<%=index%>" >
                    <p><em><%= cat %></em></p>
                    <p><%= @descriptions[cat] %></p>
                  </div>
                <% end %>
              <% end %>
            <% end %>
            <%# bar chart display %>
            <div class="w-75 mb-3">
              <%= bar_chart(@categories) %>
            </div>
          <% end %>
          <div class="mb-5">
            <%# post to instagram button if all values are nil %>
            <% if @categories.values.all?(nil) && @result.profanity_type == nil && @result.profanity_match == nil && @result.profanity_intensity == nil %>
              <% if @danger.empty? && @result.profanity_type == nil && @result.profanity_match == nil && @result.profanity_intensity == nil %>
                <%= link_to "Post to instagram!", "https://www.instagram.com/", class: "button mb-5" %>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
